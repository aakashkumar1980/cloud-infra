# ============================================================================
# VPC Peering Test - Custom Firewall Rules
# ============================================================================
# This file defines security group rules specific to the VPC peering
# connectivity test module.
#
# Architecture:
#   - Bastion (vpc_a public): Jump host with all ingress for testing
#   - VPC A Private: Target instance in same VPC
#   - VPC B Private: Target instance in peered VPC
#
# Note: These rules use dynamic CIDR blocks that are passed as variables
# (vpc_a_cidr, vpc_b_cidr, my_ip) at runtime.
# ============================================================================

# ----------------------------------------------------------------------------
# Bastion Security Group Rules
# ----------------------------------------------------------------------------
# The bastion uses all_traffic from common firewall.yaml for ingress
# Custom egress defined here
# ----------------------------------------------------------------------------
bastion:
  egress:
    - description: all_outbound
      protocol: "-1"
      cidr_ipv4: 0.0.0.0/0

# ----------------------------------------------------------------------------
# VPC A Private Instance Security Group Rules
# ----------------------------------------------------------------------------
# Allows SSH, ICMP and iperf3 from VPC A and VPC B for connectivity and
# bandwidth testing within VPC and across VPC peering
# ----------------------------------------------------------------------------
vpc_a_private:
  ingress:
    - description: ssh_from_vpc_a
      protocol: tcp
      from_port: 22
      to_port: 22
      # cidr_ipv4: will be set dynamically to var.vpc_a_cidr

    - description: ssh_from_vpc_b_via_peering
      protocol: tcp
      from_port: 22
      to_port: 22
      # cidr_ipv4: will be set dynamically to var.vpc_b_cidr

    - description: icmp_from_vpc_a
      protocol: icmp
      from_port: -1
      to_port: -1
      # cidr_ipv4: will be set dynamically to var.vpc_a_cidr

    - description: icmp_from_vpc_b
      protocol: icmp
      from_port: -1
      to_port: -1
      # cidr_ipv4: will be set dynamically to var.vpc_b_cidr

    - description: iperf3_from_vpc_a
      protocol: tcp
      from_port: 5201
      to_port: 5201
      # cidr_ipv4: will be set dynamically to var.vpc_a_cidr

    - description: iperf3_from_vpc_b_via_peering
      protocol: tcp
      from_port: 5201
      to_port: 5201
      # cidr_ipv4: will be set dynamically to var.vpc_b_cidr

  egress:
    - description: all_outbound
      protocol: "-1"
      cidr_ipv4: 0.0.0.0/0

# ----------------------------------------------------------------------------
# VPC B Private Instance Security Group Rules
# ----------------------------------------------------------------------------
# Allows SSH, ICMP and iperf3 from VPC A (via peering) and VPC B (within VPC)
# for cross-VPC and intra-VPC connectivity testing
# ----------------------------------------------------------------------------
vpc_b_private:
  ingress:
    - description: ssh_from_vpc_a_via_peering
      protocol: tcp
      from_port: 22
      to_port: 22
      # cidr_ipv4: will be set dynamically to var.vpc_a_cidr

    - description: ssh_from_vpc_b
      protocol: tcp
      from_port: 22
      to_port: 22
      # cidr_ipv4: will be set dynamically to var.vpc_b_cidr

    - description: icmp_from_vpc_a_via_peering
      protocol: icmp
      from_port: -1
      to_port: -1
      # cidr_ipv4: will be set dynamically to var.vpc_a_cidr

    - description: icmp_from_vpc_b
      protocol: icmp
      from_port: -1
      to_port: -1
      # cidr_ipv4: will be set dynamically to var.vpc_b_cidr

    - description: iperf3_from_vpc_a_via_peering
      protocol: tcp
      from_port: 5201
      to_port: 5201
      # cidr_ipv4: will be set dynamically to var.vpc_a_cidr

    - description: iperf3_from_vpc_b
      protocol: tcp
      from_port: 5201
      to_port: 5201
      # cidr_ipv4: will be set dynamically to var.vpc_b_cidr

  egress:
    - description: all_outbound
      protocol: "-1"
      cidr_ipv4: 0.0.0.0/0
